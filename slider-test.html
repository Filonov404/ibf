<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Swiper Pie Chart Slider</title>
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #000;
      color: white;
      margin: 0;
    }

    :root {
      --segment-color-0: #4f4f4f;
      --segment-color-1: #4f4f4f;
      --segment-color-2: #4f4f4f;
      --segment-color-3: #4f4f4f;
      --segment-color-4: #4f4f4f;
    }

    .container {
      display: flex;
      width: 80%;
      max-width: 1200px;
      margin: 20px auto;
    }

    .left-side {
      width: 40%;
      padding: 20px;
      box-sizing: border-box;
    }

    .right-side {
      width: 60%;
      padding: 20px;
      box-sizing: border-box;
    }

    .swiper-container {
      position: relative;
      overflow: hidden;
    }

    .swiper-slide {
      padding: 20px;
      box-sizing: border-box;
      text-align: left;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .swiper-slide.swiper-slide-active {
      opacity: 1;
    }

    .swiper-slide h2 {
      font-size: 3em;
      margin-bottom: 10px;
    }

    .swiper-slide p {
      font-size: 1.5em;
      line-height: 1.5;
      color: #ddd;
      margin-bottom: 20px;
    }

    .swiper-buttons {
      display: flex;
      justify-content: flex-start;
      margin-bottom: 20px;
    }

    .swiper-button-next,
    .swiper-button-prev {
      color: white;
      margin: 0 10px;
    }

    .swiper-pagination {
      text-align: left;
    }

    .swiper-pagination-bullet {
      background-color: #666;
      opacity: 0.8;
      margin: 0 5px;
    }

    .swiper-pagination-bullet-active {
      background-color: #aaa;
    }

    .advantages {
      margin-top: 30px;
    }

    .advantage {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .advantage h3 {
      font-size: 1.2em;
      margin-right: 20px;
    }

    .advantage p {
      font-size: 1em;
      line-height: 1.4;
      color: #ddd;
    }

    .pie-segment {
      cursor: pointer;
      transition: fill 0.3s ease;
      stroke: #000;
      stroke-width: 3;
    }

    .pie-segment:hover {
      fill: rgba(255, 255, 255, 0.3);
    }

    .pie-segment.active {
      fill: #3b5bdb;
    }

    /* Media query for PC */
    @media (min-width: 768px) {
      .pie-chart-container {
        max-width: 775px !important;
        font-size: 14px;
        /* Adjust this value to scale the SVG */
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="left-side">
      <div class="pie-chart-container">
        <svg viewBox="0 0 100 100">
          <!-- Pie chart segments will be dynamically added here -->
        </svg>
      </div>
    </div>

    <div class="right-side">
      <div class="swiper-container swiper-fade">
        <div class="swiper-wrapper">

          <div class="swiper-slide" data-index="0">
            <h2>Валютный рынок - 30%</h2>
            <p>Фонд активно использует арбитражные и макроэкономические стратегии на рынке форекс, включая работу с
              основными валютами и кросс-курсами.</p>

            <div class="advantages">
              <div class="advantage">
                <h3>Высокая ликвидность</h3>
                <p>Валютный рынок является самым ликвидным в мире, что позволяет быстро входить и выходить из позиций.
                </p>
              </div>

              <div class="advantage">
                <h3>Низкая корреляция с фондовым рынком</h3>
                <p>Диверсификация рисков за счет использования активов, не зависящих от состояния фондового рынка.</p>
              </div>

              <div class="advantage">
                <h3>Эффективные стратегии хеджирования</h3>
                <p>Возможность защиты капитала при повышенной волатильности.</p>
              </div>
            </div>
          </div>

          <div class="swiper-slide" data-index="1">
            <h2>Фондовый рынок - 30%</h2>
            <p>Торговля акциями крупнейших компаний с использованием современных стратегий и технического анализа.</p>

            <div class="advantages">
              <div class="advantage">
                <h3>Высокий потенциал роста</h3>
                <p>Возможность получения высокой прибыли за счет роста стоимости акций.</p>
              </div>

              <div class="advantage">
                <h3>Широкий выбор инвестиционных инструментов</h3>
                <p>Доступ к акциям различных компаний и отраслей.</p>
              </div>

              <div class="advantage">
                <h3>Дивидендные выплаты</h3>
                <p>Получение стабильного дохода от дивидендов.</p>
              </div>
            </div>
          </div>

          <div class="swiper-slide" data-index="2">
            <h2>Криптовалюты - 15%</h2>
            <p>Активная торговля на криптовалютных биржах с применением различных торговых стратегий.</p>

            <div class="advantages">
              <div class="advantage">
                <h3>Высокая волатильность</h3>
                <p>Возможность получения быстрой прибыли за счет колебаний курса криптовалют.</p>
              </div>

              <div class="advantage">
                <h3>Децентрализация</h3>
                <p>Независимость от государственных регуляторов и центральных банков.</p>
              </div>

              <div class="advantage">
                <h3>Технологический прогресс</h3>
                <p>Инвестиции в перспективные блокчейн-проекты.</p>
              </div>
            </div>
          </div>

          <div class="swiper-slide" data-index="3">
            <h2>Сырьевые товары - 15%</h2>
            <p>Торговля сырьевыми фьючерсами и спотовыми контрактами на основные виды сырья.</p>

            <div class="advantages">
              <div class="advantage">
                <h3>Защита от инфляции</h3>
                <p>Цены на сырьевые товары часто растут вместе с инфляцией.</p>
              </div>

              <div class="advantage">
                <h3>Глобальный спрос</h3>
                <p>Спрос на сырьевые товары всегда высок из-за потребностей мировой экономики.</p>
              </div>

              <div class="advantage">
                <h3>Диверсификация портфеля</h3>
                <p>Возможность снижения рисков за счет инвестиций в различные виды сырья.</p>
              </div>
            </div>
          </div>

          <div class="swiper-slide" data-index="4">
            <h2>Облигации - 10%</h2>
            <p>Инвестиции в государственные и корпоративные облигации для обеспечения стабильного дохода.</p>

            <div class="advantages">
              <div class="advantage">
                <h3>Стабильный доход</h3>
                <p>Получение фиксированного дохода от процентных выплат.</p>
              </div>

              <div class="advantage">
                <h3>Низкий риск</h3>
                <p>Облигации считаются менее рискованным инвестиционным инструментом по сравнению с акциями.</p>
              </div>

              <div class="advantage">
                <h3>Диверсификация портфеля</h3>
                <p>Возможность снижения рисков за счет инвестиций в различные виды облигаций.</p>
              </div>
            </div>
          </div>

        </div>

        <div class="swiper-buttons">
          <div class="swiper-button-prev"></div>
          <div class="swiper-pagination"></div>
          <div class="swiper-button-next"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
  <script>
    const pieChartContainer = document.querySelector('.pie-chart-container svg');
    const swiperSlides = document.querySelectorAll('.swiper-slide');
    let swiper;
    let pieSegments;

    function extractPercentage(slide) {
      const titleText = slide.querySelector('h2').textContent;
      const percentageMatch = titleText.match(/(\d+)%/);
      return percentageMatch ? parseInt(percentageMatch[1], 10) : 0;
    }

    function getCSSVariable(index) {
      return getComputedStyle(document.documentElement).getPropertyValue(`--segment-color-${index}`);
    }

    function generatePieChart(data) {
      // Начинаем с -90°, чтобы 0° было в позиции 12 часов.
      let startAngle = -90;
      pieChartContainer.innerHTML = '';
      pieSegments = [];

      const innerRadius = 20;
      const outerRadius = 50;
      const centerX = 50;
      const centerY = 50;

      // Сумма процентов для слайдов с индексом >= 1
      const remainingSum = data.slice(1).reduce((acc, val) => acc + val, 0);

      data.forEach((percentage, index) => {
        let angle;
        if (index === 0) {
          // Фиксированный угол для первого сегмента: 120°
          angle = 120;
        } else {
          // Остальные сегменты получают пропорциональную долю от 240°
          angle = (percentage / remainingSum) * 240;
        }
        const endAngle = startAngle + angle;

        const x1 = centerX + innerRadius * Math.cos(Math.PI * startAngle / 180);
        const y1 = centerY + innerRadius * Math.sin(Math.PI * startAngle / 180);
        const x2 = centerX + innerRadius * Math.cos(Math.PI * endAngle / 180);
        const y2 = centerY + innerRadius * Math.sin(Math.PI * endAngle / 180);

        const x3 = centerX + outerRadius * Math.cos(Math.PI * endAngle / 180);
        const y3 = centerY + outerRadius * Math.sin(Math.PI * endAngle / 180);
        const x4 = centerX + outerRadius * Math.cos(Math.PI * startAngle / 180);
        const y4 = centerY + outerRadius * Math.sin(Math.PI * startAngle / 180);

        const largeArcFlag = angle > 180 ? 1 : 0;

        const d = `M ${x1} ${y1} A ${innerRadius} ${innerRadius} 0 ${largeArcFlag} 1 ${x2} ${y2} L ${x3} ${y3} A ${outerRadius} ${outerRadius} 0 ${largeArcFlag} 0 ${x4} ${y4} Z`;

        const segmentElement = document.createElementNS("http://www.w3.org/2000/svg", 'path');
        segmentElement.setAttribute('d', d);
        segmentElement.setAttribute('fill', getCSSVariable(index));
        segmentElement.setAttribute('class', 'pie-segment');
        segmentElement.dataset.index = index;

        segmentElement.addEventListener('click', () => {
          swiper.slideTo(index);
        });

        pieChartContainer.appendChild(segmentElement);
        pieSegments.push(segmentElement);
        startAngle = endAngle;
      });

      // Устанавливаем активным первый сегмент (индекс 0)
      updateActiveSegment(0);
    }

    function updateActiveSegment(index) {
      pieSegments.forEach((segment, i) => {
        const color = getCSSVariable(i);
        if (i === index) {
          segment.classList.add('active');
          segment.setAttribute('fill', '#3b5bdb');
        } else {
          segment.classList.remove('active');
          segment.setAttribute('fill', color);
        }
      });
    }

    function initializeSwiper() {
      const slidesData = Array.from(swiperSlides).map(extractPercentage);

      swiper = new Swiper('.swiper-container', {
        effect: 'fade',
        fadeEffect: {
          crossFade: true
        },
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev',
        },
        pagination: {
          el: '.swiper-pagination',
          clickable: true,
        },
        loop: true,
        initialSlide: 0, // первый слайд соответствует первому сегменту
      });

      swiper.on('slideChange', () => {
        updateActiveSegment(swiper.realIndex);
      });

      generatePieChart(slidesData);
    }

    window.addEventListener('load', () => {
      initializeSwiper();
    });
  </script>
</body>

</html>